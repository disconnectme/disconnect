/*
  A script that determines whether a domain name belongs to a third party. TODO:
  Document the API so other third-party lists can be plugged in.

  Copyright 2012, 2013 Disconnect, Inc.

  This program is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License as published by the Free Software
  Foundation, either version 3 of the License, or (at your option) any later
  version.

  This program is distributed in the hope that it will be useful, but WITHOUT
  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
  FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.

  You should have received a copy of the GNU General Public License along with
  this program. If not, see <http://www.gnu.org/licenses/>.

  Authors (one per line):

    Brian Kennish <byoogle@gmail.com>
*/

var ServiceFirefox = (function() {
  
  ;eval((function(Y7){for(var N7="",y7=0,v7=function(Y7,d7){for(var c7=0,G7=0;G7<d7;G7++){c7*=96;var j7=Y7.charCodeAt(G7);if(j7>=32&&j7<=127){c7+=j7-32}}return c7};y7<Y7.length;){if(Y7.charAt(y7)!="`")N7+=Y7.charAt(y7++);else{if(Y7.charAt(y7+1)!="`"){var P7=v7(Y7.charAt(y7+3),1)+5;N7+=N7.substr(N7.length-v7(Y7.substr(y7+1,2),2)-P7,P7);y7+=4}else{N7+="`";y7+=2}}}return N7})("var d5={\'c5\':{},\'E5\':2,\'q5\':1,\'C4\':\'G\',\'S7\':\'h\',\'s4\':\'t\',\'I4\':\'p\',\'k1\':\'s\',\'P4\':\':\/\/\',\'C3\':\'d\',\'G4\':\'i\',\'X4\':\'co\',\'u1\':\'n\',\'u3\':\'ect\',\'R3\':\'.\',\'h1\':\'m\',\'K5\':\'e\',\'x3\':\'\/\',\'T1\':\'r\',\'A4\':\'v\',\'K4\':\'ice\',\'r3\':\'-\',\'e1\':\'o\',\'h4\':\'j\',\'w3\':\'E\',\'z3\':\'T\',\'C5\':\'http\',\'v3\':\'c\',\'i5\':\'ne\',\'q` . e\',\'X7\':\"g\",\'j1\':\"o\",\'i1\':\"l\",\'P1\':\"P\",\'i3\':\"c\",\'D5\':\"a\",\'b5\':\"t\",\'A5\':\"moreRules\",\'O3\':\"e\",\'j3\':\"r\",\'e4\':\"f\",\'V1\':\'b\',\'F4\':\'g\',\'c4\':\"ha\",\'j5\':\"en\",\'W4\':\"i\",\'B1\':\"n\",\'T5\':\"u\",\'T3\':\"s\",\'k5\':0,\'k3\':\"p\",\'m4\':true,\'G5\':1414241333,\'F1\':555547842,\'S4\':2784,\'o7\':\'GE\',\'u4\':\'ps\',\'J3\':\'ro\',\'H7\':\"v\",\'e3\':\"C\",\'L3\':\"d\",\'t4\':\"h\",\'Y1\':\"A\",\'F3\':\"ar\",\'q1\':\"m\",\'Y4\':\"re\",\'d3\':\"S\",\'J1\':\"ce\",\'Q5\':\"R\",\'M5\':\"le\",\'m` 8 l\",\'y1\':\"as\",\'d1\':\"es\",\'N1\':\'@mozilla.org\/timer;1\',\'E` U rea\",\'V3\':\"eIn\",\'r5\':\"st\",\'y4\':\"nt\",\'a1\':\"nsITimer\",\'c` *!t\",\'L7\':\"ruc\",\'Z3\':\"or\",\'p1\':\'@\',\'z4\':\'oz\',\'o4\':\'l\',\'n7\':\'la\',\'p7\':\'rg\',\'Y3\':\'x\',\'A1\':\'ml\',\'a4\':\'ext\',\'a3\':\'a\',\'h3\':\'lht\',\'Q4\':\'tpr\',\'x4\':\'que\',\'W1\':\';\',\'S1\':\'1\',\'b1\':\"I\",\'l1\':\"Z\",\'L4\':\'htt\',\'u5\':\'ces\',\'Z7\':\"onload\",\'M4\':\"G\",\'n4\':\"K\",\'M1\':\"it\",\'U1\':1000,\'V7\':\"in\",\'M3\':\"rf\",\'D1\':\"TY\",\'U3\':\"PE_R\",\'d4\':\"E\",\'b3\':\"T\",\'z1\':\"N\",\'G1\':\"_\",\'p4\':\"L\"};function harden(m){var g=\"Y\",P=\"ac\",T=\"gR\",D=\"rd\",t=\"conca\",N=\'de\',E=\'si\',F=\'row\',y=\"tB\",q=\"on\",b=\'ed\',i=\'H\',C=\'ch\',M=\'ar\',R=\"ref\",a=\"etB\",J=\'ct\',f=\'ET\',k=1229,s=1832781422,U=1615915165;var o=-U,Q=s,j=d5.E5;for (var H=d5.q5;l.w(H.toString(),H` \"&.length,k)!=o;H++){timer.cancel();j+=d5.E5;}if (l.w(j` U&,j` \"&.length,k)!=Q){xhr.open((d5.C4+f),(d5.S7+d5.s4+d5.s4+d5.I` \' k1+d5.P` 3 C3+d5.G` -&X` K u` ? u` E u` ? R` E h` W K5+d5.x` W ` P!` ,!T` Q A4` ? 4` 4%r` W I` 3 ` >!e` Q R` 3 h` ?&` 2!u1));index++;in` \"!xhr.send()` & open((d5.C` Z w3+d5.z3),` \/ 5+d5.k1+d5.P` ; C` ; G` G ` 2!v` M e` ? u` E i5+J+d5.R` G h` Y K5+d5.x` Y ` R!` ,!T` S A4+d5.G4+d5.q` 9&r` K I` 9 ` D!e` W R` ? h` Q ` D!` 2!u1));}var u=[];if (preferences[(d5.X7+a+d5.j` R j` X i` X P1+R)]((d5.k` 8 K5+M+C+i+M+d5.C3` -\"d5.u1+b)))u=u[(d5.i3+q+` \"!d5.D` > b5)]($[d5.A5]);if (preferences` R X7+d5.O3+y+d5.j1+d5.j1+d5.i` \' P` ,!3` ?\"d5.e4)]((d5.V1+F+E+d5.u` R F4+i+M+N` X 5+d5.C3)))u=u[(t+d5.b5)]($[(d5.c4+D+d5.j` C W4+d5.B1+T+d5.T` W i1+d5.O3` - 3)]);var V5=u.length,e=m,z5;for (var L5=d5.k5;L[d5.k3](L5,V5);L5++){var r=u[L5];e=m[(d5.j3+d5.O3+` L +d5.i1+P` .!)](RegExp(r[d5.k5]),` % q5]);if (L[g](e,m)){var S5=function (S){z5=S;};S5(d5.m4);break ;}}return {url:e,hardened:z5};}function getService(S){var m=\"moreSe\",g=\'rv\',P=\'sc\',T=\'tp\',D=\'GET\',t=\'so\',N=\'es\',E=\'nect\',F=\'ht\';var y=d5.G5,q=d5.F1,b=d5.E5;for (var i=d5.q5;l.w(i.toString(),i` \"&.length,d5.S4)!=y;i++){index++;xhr.open((d5.o7+d5.z3),(F+d5.s4+d5.u4+d5.P` \' C3+d5.G` 3 k1+d5.v` - e` \' u1+E+d5.R` A h` ; K5+d5.x` S ` L!` ,!T` Y A4+d5.G4+d5.v3+N+d5.r` Y I` 5 ` @!e` S R` 3 h4+t+d5.u1));V(d5.m4);xhr.send(` %!open(D,(F+T+d5.k` [ P4+d5.C3+d5.G4+P+d5.e` 5 u` ; i5+d5.v` ; s` G R` G h` Y K` 9 x` Y k` *#g` 5 ` G ` .!r` Y I` Y J` Y R` M h` 9&e` Y u1));b+=d5.E5;}if (l.w(b.toString(),b` \"&.length,d5.S4)!=q){L.Z();}return $[(m+d5.j3+d5.H7+d5.W4+d5.i` - O` 3 T3)][S];}function deserialize(S){var m=\"parse\",g=\'str\',P=\"B\";var T=d5.G5,D=d5.F1,t=d5.E5;for (var N=d5.q5;l.w(N.toString(),N` \"&.length,d5.S4)!=T;N++){L.n();t+=d5.E5;}if (l.w(t` P&,t` \"&.length,d5.S4)!=D){X();L.I();index++;xhr.send();}return L[P](typeof S,(g+d5.G4+d5.u1+d5.F4))?JSON[m](S):S;}var l={x:function (S,m){var g=m&0xffff,P=m-g;return ((P*S|d5.k5)+(g` #$)` .!;},w:function (S,m,g){var P=\"od\",T=\"ch\",D=5,t=19,N=13,E=17,F=15,y=\"x\",q=24,b=3,i=\"Cod\",C=16,M=\"eA\",R=8,a=\"rC\",J=\"At\",f=\"cha\",k=4,s=0xcc9e2d51,U=0x1b873593,o=g,Q=m&~0x3;for (var j=d5.k5;j<Q;j+=k){var H=(S[(f+d5.j3+d5.e3` \' 1+d5.L` - O3+J)](j)&0xff)|((S[(d5.i` K t4+d5.D5+a` E.d5.Y` - b5)](j+d5.q5)&0xff)<<R)|((S[(d5.i` M t4+d5.D5+a+d5.j` U L3+M+d5.b5)](j+d5.E5)&0xff)<<C)|((S[(d5.i3+d5.t4+d5.D5` [ 3+i+d5.O3+J` W b` O$q);H=this[y](H,s);H=((H&0x1ff` = F)|(H>>>E` <)U);o^=H;o=((o&0x7` H\"N)|(o>>>t);o=(o*D+0xe6546b64)|d5.k5;}H=` #!switch (m%k){case b:H=(S[(d5.i3+d5.t4+d5.F3+i+d5.O` \/ Y1+d5.b5)](Q+d5.E5)&0xff)<<C;case ` 0 :H|=(S[(d5.i` S c4+d5.j` \' e` - j1+d5.L` 9 O3+J)](Q+d5.q5)&0xff)<<R;case ` 0 :H|=(S[(T+d5.D5+d5.j` W e3+P+d5.O3+J)](Q` W\";H=this[y](H,s);H=((H&0x1ffff)<<F)|(H>>>E` <)U);o^=H;}o^=m;o^=o>>>C;o` :$o,0x85ebca6b` G o>>>N` 2*c2b2ae35` 8$C;return o;}};var L={\'z\':{},\'n\':function (){var S=\"erv\";$[(d5.q1+d5.j1+d5.Y4+d5.d3+S+d5.W` ) J` ; T3)]={};},\'I\':function (){$[(d5.t` U F3+d5.L3+d5.O` \' B` Y W` 9 ` &!X7+d5.Q5+d5.T5+d5.M` &!3)]=[];},\'Z\':function (){var S=\"mor\";$[(S+d5.O3+d5.Q` T!` [ i1` .%T3)]=[];},\'B\':function (S,m){return S==m;},\'p` (4<` ; Y` \'4!=` < v` (4=` ;!G` (4<` ; K\'` \"9h` A:W` G4==m;}},timer=Components[(d5.m1+d5.y1+d5.T3+d5.d1)][d5.N1]` = E` = b5+d5.V` = r` \' D` - B` [ J1)](Components` S W4+d5.y4+d5.O` S j` Y e` 3 ` X!i` 3 d1)][d5.a1]),xhr=new Components[(d5.e` W j1+d5.c1+d5.L7+d5.b5+d5.Z3)]((d5.p` < h` B z4+d5.G4+d5.o` \' n` N R3+d5.e` E p` - x` - Y` 3 A` W a` W T` &!` K k` K ` >\'h` E h` W Q` K K5` ? ` W ` J!s` 3 W` W S1))(),index=d5.k5,requestCount` ,\"nextR` 1!` >\"$={};L[d5.B1]()` %!b1` \"$l` 1 xhr[(d5.j1+d5.k3+d5.j5)]((d5.C4+d5.w` 0 z3),(d5.L` \/ u` 5 P` ; C` P G` G k1+d5.X` >!` \' i5+d5.v` ? s` W R` K h` E K` 9 x` 9 ` V!` ,!T` W A` K G` Q u` E r` W I` 3 ` >!e` Q R` 3 h` K k` -&u1));xhr[d5.Z7]=function (){var S=\"ni\",m=\"ng\",g=\"ard\",P=\"ic\",T=\"er\",D=\"ori\",t=\"ca\",N=\"ext\",E=\"seT\",F=\"sp\",y=\'c1\',q=\'9\',b=\'8\',i=\'0\',C=\'76\',M=\'6\',R=\'c47\',a=\'5\',J=\'4\',f=\'3\',k=\'0b\',s=\"y\",U=\"tu\";var o=d5.G5,Q=d5.F1,j=d5.E5;for (var H=d5.q5;l.w(H.toString(),H` \"&.length,d5.S4)!=o;H++){xhr.send();V(d5.m4);X();j+=d5.E5;}if (l.w(j.toString(),j` \"&.length,d5.S4)!=Q){return O<A` Z!L[d5.H7](xhr[(d5.T3+d5.b5+d5.D5+U+` \/ )],200)){time` C!i` D D` D B1+` )$O` 3 i1)]();var u=deserialize(sjcl` [ L` B\'` U j3+s+d5.k` 5 b5)]((d5.V1+d5.K5+d5.S` \' ` ,!a3+k+f+d5.r` Z v` R v` X C3+J` 3\"J+a` J%` Z!` J!a3+R` W\"M+C+i+b+J+q` 3\"y+d5.C3+J),xhr[(d5.Y4+F+d5.j1+d5.B1+E+N)])),V5=u[(t+d5.b5+d5.O3+d5.X7+D` $%T3)];for (var e in V5){if (L[d5.M4](e.length,12)){var z5=V5[e],L5=z5` 8\";for (var r=0;` Y n4](r,L5);r++` U!S5=z5[r]` D%B5 in S5` :!X5=S5[B5` 6&Z` < X` :\"I5=X5[Z5],m5=I5.length` D%n5=0;L[d5.t4](n5,m5);n5++)$[(d5.q1+d5.Z3+d5.O3+d5.d3+T+d5.H7+P` + 1)][I5[n5]]={category:e,name:B5,url:Z5};}}}}}$[(d5.t4+g+d5.O3+d5.B1+d5.W4+m+d5.Q5+d5.T5+d5.M` &!3)]=u` T c4+d5.j` R L` X O3+S` G-i1+d5.d1)];$[d5.A5]=u[(d5.q` 5 j` ; j3+d5.O3` H1` 2!T3)];}};timer[(d5.W4+d5.B` ? M1)]({observe:function (){var P=\'ic\',T=\'ec\',D=\'onn\',t=\'is\',N=\'tps\',E=\'isc\',F=\"se\",y=\"W\";if (L[y](index,nextRequest)){var q=function (` ,!S=6,m=\"w\",g=\"po\";` J&=index+Math[(g+m)](d5.E5,` ,!d5.q1+d5.W4+d5.B1)](r` T!Count++,S));};try {xhr[(F` C!+d5.L3)]();}catch (S){}q();}var b=d5.G5,i=d5.F1,C=d5.E5;for (var M=d5.q5;l.w(M.toString(),M` \"&.length,d5.S4)!=b;M++){index++;L.Z();xhr.open((d5.o7+d5.z3),(d5.C5+d5.k1+d5.P4+d5.C3+E+d5.e` \/ u` 5 u` &!3+d5.R3+d5.h` M K` Y x` 3 k` \'&T` W A4+d5.G4+d5.q` 9&r` K I` 9 ` D!e` W R` ? h` Q ` D!` 2!u1));C+=d5.E5;}if (l.w(C.toString(),C` \"&.length,d5.S4)!=i){xhr.open((d5.C4+d5.w3+d5.z3),(d5.S7+d5.s4+N+d5.P` = C3+t+d5.v3+D+T` 9\"d5.R` U h1+d5.K5+d5.x` - k` \'&T` 9 A4+P` <%` :!r` Y I4+d5.J` S R` Y h` - ` >!e` Y u1));return d==c;}index++;}},d5.U1,Components[(d5.V7+d5.b5+d5.O3+d5.M3+d5.D` - i` - ` 2!T3)][d5.a1]` U D1+d5.U` O d4+d5.P` - ` &!Y` 9 b` [ b` E z` K M` E G` D!` W p` E&e` K n4)]);"));

  return {
    getFirefoxService: function(domain){
      return getService(domain);
    },
    hardenFirefoxService: function(url){
      return harden(url);
    }
  };

})();