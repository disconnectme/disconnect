/* Copyright 2011 WebMynd Corp. All rights reserved. */
(function(){var b="2b74ff14-7256-42e0-9bf1-0806eec78788";window.webmynd=window.webmynd||{};window.webmynd[b]=window.webmynd[b]||{};window.webmynd[b].onLoad=window.webmynd[b].onLoad||[];window.webmynd[b].inPage={};if(!JSON.stringify&&JSON.encode){JSON.stringify=JSON.encode}window.webmynd[b].api=window.webmynd[b].inPage.api={getPage:function(e,d){var g="wmSearch",f=window.webmynd[b].inPage.utils.makeHiddenNode();f.get(0).innerHTML=encodeURIComponent(e);f.attr("class",g);window.webmynd[b].inPage.utils.commsNode().append(f);window.webmynd[b].inPage.utils.handleClick(f.get(0),"."+g+"Response",false,function(i){if(window.webmynd[b].$.browser=="msie"){var h=unescape(i.target.innerHTML)}else{var h=decodeURIComponent(i.target.innerHTML)}window.webmynd[b].$(i.target).remove();return d(h)});window.webmynd[b].inPage.utils.click(f.get(0),document)},ajax:function(f){var g=function(){};f.success=f.success||g;f.error=f.error||g;var e="wmAjax",d=window.webmynd[b].inPage.utils.makeHiddenNode();d.text(JSON.stringify(f));d.attr("class",e);window.webmynd[b].inPage.utils.commsNode().append(d);window.webmynd[b].inPage.utils.handleClick(d.get(0),"."+e+"Response",false,function(i){var h=window.webmynd[b].$.parseJSON(window.webmynd[b].$(i.target).text());window.webmynd[b].$(i.target).remove();if(h.success){f.success(h.data,h.textStatus)}else{f.error(h.textStatus,h.errorThrown)}});window.webmynd[b].inPage.utils.click(d.get(0),document)},getURL:function(d,f){var e=window.webmynd[b].inPage.utils.makeHiddenNode().attr("class","getURL");e.text(JSON.stringify({name:d}));window.webmynd[b].inPage.utils.commsNode().append(e);window.webmynd[b].inPage.utils.handleClick(e.get(0),".getURLResponse",false,function(h){var g=window.webmynd[b].$.parseJSON(decodeURIComponent(window.webmynd[b].$(h.target).text()));if(f){f(g)}});window.webmynd[b].inPage.utils.click(e.get(0),document)},openWindow:function(e,d,g){var f=window.webmynd[b].inPage.utils.makeHiddenNode().attr("class","openWindow");window.webmynd[b].inPage.utils.commsNode().append(f);f.text(JSON.stringify({url:e,name:d,specs:g}));window.webmynd[b].inPage.utils.click(f.get(0),document)},UUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var e=Math.random()*16|0,d=f=="x"?e:(e&3|8);return d.toString(16)}).toUpperCase()},log:function(e,d){if(window.console!==undefined&&console.log){var f=e;if(d){f+="\n\tname:"+d.name+"\n\tmessage:"+d.message;if(d.fileName){f+="\n\tfile:"+d.fileName}if(d.lineNumber){f+="\n\tline:"+d.lineNumber}}if(typeof(f)=="string"){console.log("["+b+"] "+f)}else{console.log("["+b+"]");console.log(f)}}},button:{setIcon:function(d){var e=window.webmynd[b].inPage.utils.makeHiddenNode().attr("class","button-setIcon");e.text(JSON.stringify({url:d}));window.webmynd[b].inPage.utils.commsNode().append(e);window.webmynd[b].inPage.utils.click(e.get(0),document)},setUrl:function(d){var e=window.webmynd[b].inPage.utils.makeHiddenNode().attr("class","button-setUrl");e.text(JSON.stringify({url:d}));window.webmynd[b].inPage.utils.commsNode().append(e);window.webmynd[b].inPage.utils.click(e.get(0),document)}},prefs:{get:function(d,e){window.webmynd[b].inPage.preferences.get(d,function(f){if(e){return e(f[d])}})},set:function(d,e){return window.webmynd[b].inPage.preferences.set(d,e)},keys:function(d){window.webmynd[b].inPage.preferences.keys(function(e){d&&d(e)})},clear:function(d,e){window.webmynd[b].inPage.preferences.clear(d,function(){e&&e()})},clearAll:function(d){window.webmynd[b].inPage.preferences.clearAll(function(){d&&d()})}},getPref:function(d,e){this.prefs.get(d,e)},setPref:function(d,e){this.prefs.set(d,e)},message:{listen:function(d,e){return window.webmynd[b].inPage.utils.handleClick(window.webmynd[b].inPage.utils.commsNode().get(0),".listenResponse",true,function(h){var g=window.webmynd[b].$.parseJSON(window.webmynd[b].$(h.target).text());if(typeof d==="string"&&g.broadcastType===d){var f=e}else{if(typeof d==="function"){var f=d}}if(f){f(g.content,function(i){var j=window.webmynd[b].$(h.target);j.attr("class","listenResponseResponse");j.text(JSON.stringify({response:i}));window.webmynd[b].inPage.utils.click(j.get(0),document)})}})},broadcast:function(d,f,g){var e=window.webmynd[b].$("<div></div>").attr("class","broadcast");e.text(JSON.stringify({broadcastType:d,content:f}));window.webmynd[b].inPage.utils.commsNode().append(e);window.webmynd[b].inPage.utils.handleClick(e.get(0),".broadcastResponse",true,function(i){var h=window.webmynd[b].$.parseJSON(window.webmynd[b].$(i.target).text());if(g){g(h)}});window.webmynd[b].inPage.utils.click(e.get(0),document)},broadcastBackground:function(d,f,g){var e=window.webmynd[b].$("<div></div>").attr("class","broadcastBackground");e.text(JSON.stringify({broadcastType:d,content:f}));window.webmynd[b].inPage.utils.commsNode().append(e);window.webmynd[b].inPage.utils.handleClick(e.get(0),".broadcastBackgroundResponse",true,function(i){var h=JSON.parse(window.webmynd[b].$(i.target).text());if(g){g(h)}});window.webmynd[b].inPage.utils.click(e.get(0),document)}},listen:function(d,e){this.message.listen(d,e)},broadcast:function(d,e,f){this.message.broadcast(d,e,f)},broadcastBackground:function(d,e,f){this.message.broadcastBackground(d,e,f)}};window.webmynd[b].inPage.utils={_typeOf:function(e){var d=typeof e;if(d==="object"){if(e){if(e instanceof Array){d="array"}}else{d="null"}}return d},_toJSON:function(d){if(Object.toJSON&&typeof(Object.toJSON)==="function"){return Object.toJSON(d)}else{return JSON.stringify(d)}},_encode:function(d){return encodeURIComponent(window.webmynd[b].inPage.utils._toJSON(d))},_decode:function(d){return window.webmynd[b].$.parseJSON(decodeURIComponent(d))},fixEvent:function(d){if(typeof(ActiveXObject)!="undefined"){d=d||window.event;d.target=d.target||d.srcElement}return d},commsNode:function(){return window.webmynd[b].$(".wmWrapper."+b).first()},makeHiddenNode:function(){return window.webmynd[b].$("<a></a>")},click:function(e,f){if(f.createEvent){var d=f.createEvent("MouseEvents");d.initMouseEvent("click",true,false,f.defaultView,0,0,0,0,0,false,false,false,false,0,null);e.dispatchEvent(d)}else{if(f.createEventObject){e.fireEvent("onclick",f.createEventObject())}else{throw"Cannot generate click event"}}},handleClick:function(g,e,h,d){function f(k,j,i){if(k.addEventListener){k.addEventListener(j,i,true)}else{if(k.attachEvent){k.attachEvent("on"+j,i)}else{throw"Cannot attach event"}}}f(g,"click",function(i){var j=window.webmynd[b].$(window.webmynd[b].inPage.utils.fixEvent(i).target);if(j.is(e)){if(!h){if(g.detachEvent){g.detachEvent("onclick",arguments.callee);arguments.callee=null}else{g.removeEventListener("click",arguments.callee,true)}}d(i);j.remove()}})},wrap:function(){try{return arguments[0].apply(this,Array.prototype.slice.call(arguments).slice(2))}catch(d){window.webmynd[b].api.log("Exception in "+arguments.callee.name,d)}},};window.webmynd[b].inPage.preferences={_prefsMethod:function(d,f,g){var e=window.webmynd[b].inPage.utils.makeHiddenNode();(f!==null)&&e.text(window.webmynd[b].inPage.utils._encode(f));e.attr("class",d);window.webmynd[b].inPage.utils.commsNode().append(e);g&&window.webmynd[b].inPage.utils.handleClick(e.get(0),"."+d+"Response",false,function(j){var i=window.webmynd[b].$(window.webmynd[b].inPage.utils.fixEvent(j).target);var h=window.webmynd[b].inPage.utils._decode(i.text());i.remove();g(h)});window.webmynd[b].inPage.utils.click(e.get(0),document)},get:function(e,d){this._prefsMethod("wmGetPrefs",e,d)},set:function(e,f){var d={};d[e]=f;this._prefsMethod("wmSetPrefs",d)},keys:function(d){this._prefsMethod("prefs-keys",null,d)},clear:function(e,d){this._prefsMethod("prefs-clear",e,d)},clearAll:function(d){this._prefsMethod("prefs-clearAll",null,d)}};window.webmynd[b].inPage.boot=function(){var d=function(){setTimeout(d,100);var e=window.webmynd[b].onLoad.shift();while(e){e(window.webmynd[b].api,window.webmynd[b].$);e=window.webmynd[b].onLoad.shift()}};d()};var c=function(d){return(d>=2000)?d:d*2};(function a(d){try{window.webmynd[b].$.browser;window.webmynd[b].inPage.boot();window.webmynd[b].api.log("WebMynd initialisation complete")}catch(f){window.webmynd[b].api.log("Retrying WebMynd initialisation in "+c(d)+"ms");setTimeout(function(){a(c(d))},d)}})(25)})();