/* Copyright 2011 WebMynd Corp. All rights reserved. */
(function(c,b){var a="2b74ff14-7256-42e0-9bf1-0806eec78788";var c=c||window;var b=b||document;window=c;window.webmynd=window.webmynd||{};window.webmynd[a]=window.webmynd[a]||{};window.webmynd[a].view={createView:function(e,d,f){window.webmynd[a].view.insertStylesOnce(e.styles,d);window.webmynd[a].view.allowedRemote=e.allowedRemote;var g=[["wmGetPrefs",window.webmynd[a].view.prefs.get],["wmSetPrefs",window.webmynd[a].view.prefs.set],["prefs-keys",window.webmynd[a].view.prefs.keys],["prefs-clear",window.webmynd[a].view.prefs.clear],["prefs-clearAll",window.webmynd[a].view.prefs.clearAll],["wmSearch",window.webmynd[a].view.startSearch],["wmAjax",window.webmynd[a].view.doAjax],["broadcast",window.webmynd[a].view.broadcast],["broadcastBackground",window.webmynd[a].view.broadcastBackground],["getURL",window.webmynd[a].view.getURL],["openWindow",window.webmynd[a].view.openWindow],["button-setIcon",window.webmynd[a].view.button.setIcon],["button-setUrl",window.webmynd[a].view.button.setUrl]];window.webmynd[a].view.instrument(g);window.webmynd[a].broadcast.init();window.webmynd[a].view.insertSnippetsOnce(e.htmlSnippets,function(){window.webmynd[a].services.insertScriptsOnce(window.webmynd[a].view.document,e.scripts)});f&&window.webmynd[a].view.pollLocation()},insertStylesOnce:function(g,d){window.webmynd[a].$.each(g,function(i,j){window.webmynd[a].$("head",window.webmynd[a].view.document).append('<link rel="stylesheet" type="text/css" href="'+window.webmynd[a].utils.completeLinks(j)+'"></link>')});var e=d;var h=e.get(0).getAttribute("class")||"";e.get(0).setAttribute("class",a+(h?" "+h:h));if(window.webmynd[a].view.commsNode().length){window.webmynd[a].view.commsNode().empty();window.webmynd[a].view.commsNode().html(e.html())}else{var f=window.webmynd[a].$("body",window.webmynd[a].view.document).prepend(e)}window.webmynd[a].view.commsNode().hide()},insertSnippetsOnce:function(f,h){var e=0,d=0;for(var g in f){e+=1;window.webmynd[a].view.__getPage(f[g],(function(i){return function(k){window.webmynd[a].$("#"+i,window.webmynd[a].view.document).remove();var j=window.webmynd[a].$('<div id="'+i+'">'+k+"</div>",window.webmynd[a].view.document).hide();window.webmynd[a].view.commsNode().prepend(j);d+=1;if(d>=e){h()}}})(g))}if(e<=0){h()}},pollLocation:function(){var d=window.webmynd[a].view.document.location.href;window.webmynd[a].view.window.locationpoll=window.webmynd[a].view.document.defaultView.setTimeout(function(){window.webmynd[a].view.checkLocation(d)},50)},checkLocation:function(d){if(d==window.webmynd[a].view.document.location.href){window.webmynd[a].view.pollLocation()}else{window.webmynd[a].controller.run()}},instrument:function(e){if(!window.webmynd[a].$("script[class='wmViewInstrumented "+a+"']",window.webmynd[a].view.document).length){window.webmynd[a].$.each(e,function(f,g){window.webmynd[a].view.commsNode().get(0).addEventListener("click",function(h){if(window.webmynd[a].$(h.target).hasClass(g[0])){g[1](h)}},true)});var d=window.webmynd[a].view.document.createElement("script");d.setAttribute("class","wmViewInstrumented "+a);window.webmynd[a].$("head",window.webmynd[a].view.document).get(0).appendChild(d)}},commsNode:function(){return window.webmynd[a].$(".wmWrapper."+a,window.webmynd[a].view.document).first()},click:function(f){var d=window.webmynd[a].$(f);var e=window.webmynd[a].view.document.createEvent("MouseEvents");e.initMouseEvent("click",false,false,window.webmynd[a].view.window,0,0,0,0,0,false,false,false,false,0,null);f.dispatchEvent(e)},handleClick:function(g,e,h,d){function f(k,j,i){if(k.addEventListener){k.addEventListener(j,i,true)}else{if(k.attachEvent){k.attachEvent("on"+j,i)}else{throw"Cannot attach event"}}}f(g,"click",function(i){var j=window.webmynd[a].$(i.target);if(j.is(e)){if(!h){if(g.detachEvent){g.detachEvent("onclick",arguments.callee);arguments.callee=null}else{g.removeEventListener("click",arguments.callee,true)}}d(i);if(!h){j.remove()}}})},prefs:{__callback:function(d){return function(e){d.text(encodeURIComponent(JSON.stringify(e)));d.attr("class",d.attr("class")+"Response");window.webmynd[a].view.click(d.get(0))}},get:function(f){var d=window.webmynd[a].$(f.target);var e=JSON.parse(decodeURIComponent(d.text()));window.webmynd[a].utils.getPrefs([e],window.webmynd[a].view.prefs.__callback(d))},set:function(e){var d=JSON.parse(decodeURIComponent(window.webmynd[a].$(e.target).text()));window.webmynd[a].utils.setPrefs(d)},keys:function(e){var d=window.webmynd[a].$(e.target);window.webmynd[a].utils.prefKeys(window.webmynd[a].view.prefs.__callback(d))},clear:function(f){var d=window.webmynd[a].$(f.target);var e=JSON.parse(decodeURIComponent(d.text()));window.webmynd[a].utils.prefClear([e],window.webmynd[a].view.prefs.__callback(d))},clearAll:function(e){var d=window.webmynd[a].$(e.target);window.webmynd[a].utils.prefClearAll(window.webmynd[a].view.prefs.__callback(d))}},__getPage:function(d,g){d=window.webmynd[a].utils.completeLinks(d);var f=function(h){var i=new RegExp(h);return i.test(d)};var e=window.webmynd[a].view.allowedRemote.concat(["^resource://.*","^safari-extension://.*","^chrome.*"]);if(e.some(f)){window.webmynd[a].utils.getUrl(d,g)}else{window.webmynd[a].services.console.log('Attempt to fetch URL "'+d+'" not allowed by allowedRemote patterns.')}},startSearch:function(e){var d=decodeURIComponent(e.target.innerHTML);window.webmynd[a].view.__getPage(d,function(f){e.target.innerHTML=encodeURIComponent(f);window.webmynd[a].$(e.target).attr("class",window.webmynd[a].$(e.target).attr("class")+"Response");window.webmynd[a].view.click(e.target)})},doAjax:function(f){var d=JSON.parse(window.webmynd[a].$(f.target).text());d.url=window.webmynd[a].utils.completeLinks(d.url);var g=function(h){var i=new RegExp(h);return i.test(d.url)};var e=window.webmynd[a].view.allowedRemote.concat(["^resource://.*","^safari-extension://.*","^chrome.*"]);if(e.some(g)){window.webmynd[a].utils.doAjax(d,function(h){window.webmynd[a].$(f.target).text(JSON.stringify(h));window.webmynd[a].$(f.target).attr("class",window.webmynd[a].$(f.target).attr("class")+"Response");window.webmynd[a].view.click(f.target)})}else{window.webmynd[a].services.console.log('Attempt to fetch URL "'+d.url+'" not allowed by allowedRemote patterns.')}},broadcast:function(f){var e=window.webmynd[a].$(f.target);var d=JSON.parse(broadcastContainter.text());window.webmynd[a].utils.broadcast(d,function(g){var h=window.webmynd[a].$("<a></a>");h.attr("class",e.attr("class")+"Response");h.text(JSON.stringify(g));e.append(h);window.webmynd[a].view.click(h.get(0))})},broadcastBackground:function(f){var e=window.webmynd[a].$(f.target);var d=JSON.parse(e.text());window.webmynd[a].utils.broadcastBackground(d,function(g){var h=window.webmynd[a].$("<a></a>");h.attr("class",e.attr("class")+"Response");h.text(JSON.stringify(g));e.append(h);window.webmynd[a].view.click(h.get(0))})},getURL:function(f){var d=JSON.parse(window.webmynd[a].$(f.target).text());var e=window.webmynd[a].utils.completeLinks(d.name);window.webmynd[a].$(f.target).text(encodeURIComponent(JSON.stringify(e)));window.webmynd[a].$(f.target).attr("class",window.webmynd[a].$(f.target).attr("class")+"Response");window.webmynd[a].view.click(f.target)},openWindow:function(e){var d=JSON.parse(window.webmynd[a].$(e.target).text());window.webmynd[a].utils.openWindow(d.url,d.name,d.specs)},button:{setIcon:function(e){var d=JSON.parse(window.webmynd[a].$(e.target).text());window.webmynd[a].utils.button.setIcon(d)},setUrl:function(e){var d=JSON.parse(window.webmynd[a].$(e.target).text());window.webmynd[a].utils.button.setUrl(d)}}};window.webmynd[a].controller={shouldActivate:function(d,f){var e=false;if(d.slice(0,5)==="https"){return false}window.webmynd[a].$.each(f,function(g,i){if(typeof(i)==="object"){var h=i[0]}else{var h=i}regexp=new RegExp("[a-z:/]*([a-z]{2,3}\\.)?"+h);if(d.match(regexp)&&!e){e=true}});return e},run:function(){if(c.parent.top!=c){return}var d=new Date().getTime();window.webmynd[a].view.window=c;window.webmynd[a].view.document=b;window.webmynd[a].utils.getPrefs(["trigger_on_location_change","activations","body","version"],function(f){var n=f.activations;var j={patterns:[],scripts:[],styles:[],allowedRemote:[],htmlSnippets:{}};for(var k=0;k<n.length;k++){var m=n[k];var g=window.webmynd[a].controller.shouldActivate(window.webmynd[a].view.document.location.href,m.patterns);if(g){m.activated=true;["scripts","styles","allowedRemote"].forEach(function(i){if(typeof(m[i])!=="undefined"){m[i].forEach(function(o){if(j[i].indexOf(o)<0){j[i].push(o)}})}});if(m.htmlSnippets){for(var e in m.htmlSnippets){j.htmlSnippets[e]=m.htmlSnippets[e]}}}}if(n.some(function(i){return i.activated})){var l=window.webmynd[a].$(f.body,window.webmynd[a].view.document),h=function(){return window.webmynd[a].view.createView(j,l,f.trigger_on_location_change)};if(window.webmynd[a].$("body",window.webmynd[a].view.document).length){h()}else{window.webmynd[a].$(window.webmynd[a].view.document).ready(h)}}else{if(f.trigger_on_location_change){window.webmynd[a].view.pollLocation()}}})}};window.webmynd[a].controller.run()})(win,doc);