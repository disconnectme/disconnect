/* Copyright 2011 WebMynd Corp. All rights reserved. */
(function(){var a="2b74ff14-7256-42e0-9bf1-0806eec78788";window.webmynd=window.webmynd||{};window.webmynd[a]=window.webmynd[a]||{};window.webmynd[a].model={hour:0,init:function(b){window.webmynd[a].model._defaultHost="http://www.webmynd.com";window.webmynd[a].model._defaults={};window.webmynd[a].model._remoteCache={};window.webmynd[a].model.setPrefs(b,true);if(!window.webmynd[a].model._defaults.resources){window.webmynd[a].model._defaults.resources={}}window.webmynd[a].model._defaults.resources._wmCountry={type:"remote",url:"/locate"};window.webmynd[a].model.getResources();window.webmynd[a].model.hour=new Date().getHours()},reGetResources:function(){var b=new Date().getHours();if(b>window.webmynd[a].model.hour||(b==0&&window.webmynd[a].model.hour==23)){window.webmynd[a].model.getResources()}window.webmynd[a].model.hour=b},processRemoteResource:function(b){return function(c){if(c){window.webmynd[a].model._remoteCache[b]=c}}},_getResource:function(c){var d=new RegExp("^http:|^https:"),e=new Date().getTime(),b=d.test(window.webmynd[a].model._defaults.resources[c].url)?window.webmynd[a].model._defaults.resources[c].url:window.webmynd[a].model._defaultHost+window.webmynd[a].model._defaults.resources[c].url+"?"+e;window.webmynd[a].model.getUrl(b,window.webmynd[a].model.processRemoteResource(c))},getResources:function(){for(var b in window.webmynd[a].model._defaults.resources){if(window.webmynd[a].model._defaults.resources[b].type&&window.webmynd[a].model._defaults.resources[b].type.match("remote")){window.webmynd[a].model._getResource(b)}}},getPrefs:function(e,c){var d=0,b={};e.forEach(function(f){window.webmynd[a].model._getPref(f,function(g){b[f]=g;d+=1;if(d>=e.length){c(b)}})})},_getPref:function(d,c){var b=null;if(window.webmynd[a].model._defaults.resources[d]&&window.webmynd[a].model._defaults.resources[d].type&&window.webmynd[a].model._defaults.resources[d].type.match("remote")){if(!window.webmynd[a].model._remoteCache[d]){window.webmynd[a].model._getResource(d)}b=window.webmynd[a].model._remoteCache[d];window.webmynd[a].model.reGetResources();return c(b)}else{var e;if(window.webmynd[a].model._defaults.resources[d]){e=window.webmynd[a].model._defaults.resources[d].type}window.webmynd[a].services.getLocalPref(d,e,function(f){if(f===null&&typeof(window.webmynd[a].model._defaults[d])!=="undefined"){f=window.webmynd[a].model._defaults[d]}return c(f)})}},setPrefs:function(e,d){for(var b in e){var c=e[b];if(d){window.webmynd[a].model._defaults[b]=c}else{var f;if(window.webmynd[a].model._defaults.resources[b]){f=window.webmynd[a].model._defaults.resources[b].type}window.webmynd[a].services.setLocalPref(b,f,c)}}},prefs:{keys:function(b){return window.webmynd[a].services.getLocalKeys(b)},clear:function(c,d){for(var b=0;b<c.length;b++){if(c[b].slice(0,3)!=="_wm"){window.webmynd[a].services.clearLocalKey(c[b])}}d&&d(b)},clearAll:function(b){this.clear(this.keys(),b)}},getUrl:function(b,c){var d=window.webmynd[a].services.newXHR();d.onload=function(){if(d.readyState==4){if((d.status>=200&&d.status<300)||d.status==304){c(d.responseText)}else{c(d.responseText);window.webmynd[a].services.console.log("Status code: "+d.status+" from: "+b)}d=null}};d.open("GET",b);d.send(null)},doAjax:function(c,b){c.success=function(e,f,d){b({success:true,data:e,textStatus:f})};c.error=function(d,f,e){b({success:false,textStatus:f,errorThrown:e})};c.dataType="text";window.webmynd[a].$.ajax(c)}}})();